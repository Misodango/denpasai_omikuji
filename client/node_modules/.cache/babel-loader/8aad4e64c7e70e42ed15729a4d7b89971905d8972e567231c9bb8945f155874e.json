{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback}from'react';import axios from'axios';import html2canvas from'html2canvas';import QRCode from'qrcode.react';import'./App.css';import ErrorBoundary from'./ErrorBoundary';// import QRCodeWrapper from './QRCodeWrapper';\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const[omikujiData,setOmikujiData]=useState(null);const[qrCodeData,setQrCodeData]=useState('');const omikujiRef=useRef(null);useEffect(()=>{let isMounted=true;const fetchData=async()=>{try{const response=await axios.get('http://localhost:5000/get-last-data');if(isMounted){setOmikujiData(response.data);}}catch(error){console.error('Error fetching data:',error);}};fetchData();const interval=setInterval(fetchData,5000);return()=>{isMounted=false;clearInterval(interval);};},[]);const[isQRReady,setIsQRReady]=useState(false);const captureAndGenerateQR=useCallback(async()=>{if(omikujiRef.current){try{const canvas=await html2canvas(omikujiRef.current);const imageData=canvas.toDataURL('image/png');setQrCodeData(imageData);setIsQRReady(true);}catch(error){console.error('Error generating QR code:',error);}}},[]);useEffect(()=>{if(omikujiData){captureAndGenerateQR();}},[omikujiData,captureAndGenerateQR]);useEffect(()=>{return()=>{// コンポーネントのアンマウント時にクリーンアップを行う\nsetOmikujiData(null);setQrCodeData('');};},[]);if(!omikujiData){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}const firstColumnItems=['運勢','助言','願事','恋愛','待人'];const secondColumnItems=['商売','旅立','学問','病気','開運物','開運色'];return/*#__PURE__*/_jsxs(\"div\",{className:\"omikuji-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"omikuji-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"omikuji-title\",children:\"\\u304A\\u307F\\u304F\\u3058\\u5802\"}),/*#__PURE__*/_jsx(\"div\",{ref:omikujiRef,className:\"omikuji-paper\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"omikuji-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"omikuji-column\",children:firstColumnItems.map(key=>/*#__PURE__*/_jsxs(\"div\",{className:\"category \".concat(key==='運勢'?'omikuji-result':''),children:[/*#__PURE__*/_jsxs(\"span\",{className:\"category-name\",children:[key,\"\\uFF1A\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"category-fortune\",children:omikujiData[key]})]},key))}),/*#__PURE__*/_jsx(\"div\",{className:\"omikuji-column\",children:secondColumnItems.map(key=>/*#__PURE__*/_jsxs(\"div\",{className:\"category\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"category-name\",children:[key,\"\\uFF1A\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"category-fortune\",children:omikujiData[key]})]},key))})]})})]}),isQRReady&&qrCodeData&&/*#__PURE__*/_jsx(\"div\",{className:\"qr-code-container\",children:/*#__PURE__*/_jsx(QRCode,{value:qrCodeData,size:128})}),/*#__PURE__*/_jsx(ErrorBoundary,{children:qrCodeData&&/*#__PURE__*/_jsx(\"div\",{className:\"qr-code-container\",children:/*#__PURE__*/_jsx(QRCode,{value:qrCodeData,size:128})})})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","axios","html2canvas","QRCode","ErrorBoundary","jsx","_jsx","jsxs","_jsxs","App","omikujiData","setOmikujiData","qrCodeData","setQrCodeData","omikujiRef","isMounted","fetchData","response","get","data","error","console","interval","setInterval","clearInterval","isQRReady","setIsQRReady","captureAndGenerateQR","current","canvas","imageData","toDataURL","children","firstColumnItems","secondColumnItems","className","ref","map","key","concat","value","size"],"sources":["/home/misodango/kosen/2023/2024/radioFest/project-root/client/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef , useCallback} from 'react';\nimport axios from 'axios';\nimport html2canvas from 'html2canvas';\nimport QRCode from 'qrcode.react';\nimport './App.css';\nimport ErrorBoundary from './ErrorBoundary';\n// import QRCodeWrapper from './QRCodeWrapper';\n\nfunction App() {\n  const [omikujiData, setOmikujiData] = useState(null);\n  const [qrCodeData, setQrCodeData] = useState('');\n  const omikujiRef = useRef(null);\n\n  useEffect(() => {\n    let isMounted = true;\n\n    const fetchData = async () => {\n      try {\n        const response = await axios.get('http://localhost:5000/get-last-data');\n        if (isMounted) {\n          setOmikujiData(response.data);\n        }\n      } catch (error) {\n        console.error('Error fetching data:', error);\n      }\n    };\n\n    fetchData();\n    const interval = setInterval(fetchData, 5000);\n\n    return () => {\n      isMounted = false;\n      clearInterval(interval);\n    };\n  }, []);\n\n  const [isQRReady, setIsQRReady] = useState(false);\n\n  const captureAndGenerateQR = useCallback(async () => {\n    if (omikujiRef.current) {\n      try {\n        const canvas = await html2canvas(omikujiRef.current);\n        const imageData = canvas.toDataURL('image/png');\n        setQrCodeData(imageData);\n        setIsQRReady(true);\n      } catch (error) {\n        console.error('Error generating QR code:', error);\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    if (omikujiData) {\n      captureAndGenerateQR();\n    }\n  }, [omikujiData, captureAndGenerateQR]);\n  useEffect(() => {\n    return () => {\n      // コンポーネントのアンマウント時にクリーンアップを行う\n      setOmikujiData(null);\n      setQrCodeData('');\n    };\n  }, []);\n\n  if (!omikujiData) {\n    return <div>Loading...</div>;\n  }\n\n  const firstColumnItems = ['運勢', '助言', '願事', '恋愛', '待人'];\n  const secondColumnItems = ['商売', '旅立', '学問', '病気', '開運物', '開運色'];\n\n  return (\n    <div className=\"omikuji-container\">\n      <div className=\"omikuji-container\">\n        <h1 className=\"omikuji-title\">おみくじ堂</h1>\n        <div ref={omikujiRef} className=\"omikuji-paper\">\n          <div className=\"omikuji-content\">\n            <div className=\"omikuji-column\">\n              {firstColumnItems.map(key => (\n                <div key={key} className={`category ${key === '運勢' ? 'omikuji-result' : ''}`}>\n                  <span className=\"category-name\">{key}：</span>\n                  <span className=\"category-fortune\">{omikujiData[key]}</span>\n                </div>\n              ))}\n            </div>\n            <div className=\"omikuji-column\">\n              {secondColumnItems.map(key => (\n                <div key={key} className=\"category\">\n                  <span className=\"category-name\">{key}：</span>\n                  <span className=\"category-fortune\">{omikujiData[key]}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n      {isQRReady && qrCodeData && (\n        <div className=\"qr-code-container\">\n          <QRCode value={qrCodeData} size={128} />\n        </div>\n      )}\n\n      <ErrorBoundary>\n        {qrCodeData && (\n          <div className=\"qr-code-container\">\n            <QRCode value={qrCodeData} size={128} />\n          </div>\n        )}\n      </ErrorBoundary >\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}